apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: poi-video-platform-prod

resources:
  - ../../base

# ── Image overrides ───────────────────────────────────────────────
# In prod, always pin to a SHA tag – never use :latest.
# These are updated by CI via `kustomize edit set image`.
images:
  - name: poi-service
    newName: ghcr.io/jgalian34/videogen_services/poi-service
    newTag: sha-0000000
  - name: asset-service
    newName: ghcr.io/jgalian34/videogen_services/asset-service
    newTag: sha-0000000
  - name: script-service
    newName: ghcr.io/jgalian34/videogen_services/script-service
    newTag: sha-0000000
  - name: transcription-service
    newName: ghcr.io/jgalian34/videogen_services/transcription-service
    newTag: sha-0000000
  - name: render-service
    newName: ghcr.io/jgalian34/videogen_services/render-service
    newTag: sha-0000000

# ── Prod patches ──────────────────────────────────────────────────
patches:
  - target:
      kind: Deployment
      labelSelector: app.kubernetes.io/component=api
    patch: |-
      - op: add
        path: /spec/template/spec/containers/0/imagePullPolicy
        value: IfNotPresent
      - op: replace
        path: /spec/replicas
        value: 2
  - target:
      kind: ConfigMap
      name: platform-config
    patch: |-
      - op: replace
        path: /data/LOG_LEVEL
        value: WARNING
      - op: replace
        path: /data/ENVIRONMENT
        value: production
      - op: replace
        path: /data/RUNWAY_STUB_MODE
        value: "false"


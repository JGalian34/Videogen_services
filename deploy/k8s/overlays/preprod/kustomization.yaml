apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: poi-video-platform-preprod

resources:
  - ../../base

# ── Image overrides ───────────────────────────────────────────────
images:
  - name: poi-service
    newName: ghcr.io/jgalian34/videogen_services/poi-service
    newTag: latest
  - name: asset-service
    newName: ghcr.io/jgalian34/videogen_services/asset-service
    newTag: latest
  - name: script-service
    newName: ghcr.io/jgalian34/videogen_services/script-service
    newTag: latest
  - name: transcription-service
    newName: ghcr.io/jgalian34/videogen_services/transcription-service
    newTag: latest
  - name: render-service
    newName: ghcr.io/jgalian34/videogen_services/render-service
    newTag: latest

# ── Preprod config patches ────────────────────────────────────────
patches:
  - target:
      kind: Deployment
      labelSelector: app.kubernetes.io/component=api
    patch: |-
      - op: add
        path: /spec/template/spec/containers/0/imagePullPolicy
        value: Always
  - target:
      kind: ConfigMap
      name: platform-config
    patch: |-
      - op: replace
        path: /data/LOG_LEVEL
        value: INFO
      - op: replace
        path: /data/ENVIRONMENT
        value: preprod

# ── Namespace override ────────────────────────────────────────────
configMapGenerator: []

# Replicas: same as dev for preprod

